// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –î–ê–ù–ù–´–ï –î–õ–Ø –ö–û–ù–°–¢–†–£–ö–¢–û–†–ê –ü–†–û–ú–ü–¢–û–í
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const TOPICS = {
    math: {
        preschool: [
            "–°—á—ë—Ç –¥–æ 5",
            "–°—á—ë—Ç –¥–æ 10", 
            "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –±–æ–ª—å—à–µ, –º–µ–Ω—å—à–µ, —Ä–∞–≤–Ω–æ",
            "–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Ñ–∏–≥—É—Ä—ã",
            "–°—á—ë—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤"
        ],
        "1": [
            "–°–ª–æ–∂–µ–Ω–∏–µ –¥–æ 10",
            "–í—ã—á–∏—Ç–∞–Ω–∏–µ –¥–æ 10",
            "–°–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ –¥–æ 10",
            "–°–æ—Å—Ç–∞–≤ —á–∏—Å–ª–∞",
            "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–∏—Å–µ–ª –¥–æ 20",
            "–ó–∞–¥–∞—á–∏ –Ω–∞ —Å–ª–æ–∂–µ–Ω–∏–µ",
            "–ó–∞–¥–∞—á–∏ –Ω–∞ –≤—ã—á–∏—Ç–∞–Ω–∏–µ"
        ],
        "2": [
            "–°–ª–æ–∂–µ–Ω–∏–µ –¥–æ 20",
            "–í—ã—á–∏—Ç–∞–Ω–∏–µ –¥–æ 20",
            "–°–ª–æ–∂–µ–Ω–∏–µ –¥–æ 100",
            "–í—ã—á–∏—Ç–∞–Ω–∏–µ –¥–æ 100",
            "–£–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ 2 –∏ 3",
            "–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è (–Ω–∞—á–∞–ª–æ)",
            "–ó–∞–¥–∞—á–∏ –≤ –¥–≤–∞ –¥–µ–π—Å—Ç–≤–∏—è"
        ],
        "3": [
            "–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è",
            "–î–µ–ª–µ–Ω–∏–µ",
            "–£–º–Ω–æ–∂–µ–Ω–∏–µ –∏ –¥–µ–ª–µ–Ω–∏–µ",
            "–í–Ω–µ—Ç–∞–±–ª–∏—á–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ",
            "–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π",
            "–£—Ä–∞–≤–Ω–µ–Ω–∏—è",
            "–ü–µ—Ä–∏–º–µ—Ç—Ä –∏ –ø–ª–æ—â–∞–¥—å"
        ],
        "4": [
            "–ú–Ω–æ–≥–æ–∑–Ω–∞—á–Ω—ã–µ —á–∏—Å–ª–∞",
            "–£–º–Ω–æ–∂–µ–Ω–∏–µ –º–Ω–æ–≥–æ–∑–Ω–∞—á–Ω—ã—Ö",
            "–î–µ–ª–µ–Ω–∏–µ –º–Ω–æ–≥–æ–∑–Ω–∞—á–Ω—ã—Ö",
            "–î—Ä–æ–±–∏",
            "–í–µ–ª–∏—á–∏–Ω—ã (–≤—Ä–µ–º—è, –¥–ª–∏–Ω–∞, –º–∞—Å—Å–∞)",
            "–°–ª–æ–∂–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è",
            "–ó–∞–¥–∞—á–∏ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏–µ"
        ]
    },
    russian: {
        preschool: [
            "–ë—É–∫–≤—ã –ê, –û, –£",
            "–ì–ª–∞—Å–Ω—ã–µ –±—É–∫–≤—ã",
            "–°–æ–≥–ª–∞—Å–Ω—ã–µ –±—É–∫–≤—ã",
            "–°–ª–æ–≥–∏"
        ],
        "1": [
            "–ì–ª–∞—Å–Ω—ã–µ –∏ —Å–æ–≥–ª–∞—Å–Ω—ã–µ",
            "–ú—è–≥–∫–∏–µ –∏ —Ç–≤—ë—Ä–¥—ã–µ —Å–æ–≥–ª–∞—Å–Ω—ã–µ",
            "–£–¥–∞—Ä–µ–Ω–∏–µ",
            "–î–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–≥–∏",
            "–ü–∏—Å—å–º–æ –±—É–∫–≤",
            "–°–ª–æ–≤–∞ —Å –±—É–∫–≤–æ–π –ô",
            "–ë–æ–ª—å—à–∞—è –±—É–∫–≤–∞ –≤ –∏–º–µ–Ω–∞—Ö"
        ],
        "2": [
            "–ë–µ–∑—É–¥–∞—Ä–Ω—ã–µ –≥–ª–∞—Å–Ω—ã–µ",
            "–ü–∞—Ä–Ω—ã–µ —Å–æ–≥–ª–∞—Å–Ω—ã–µ",
            "–ñ–ò-–®–ò, –ß–ê-–©–ê, –ß–£-–©–£",
            "–ú—è–≥–∫–∏–π –∑–Ω–∞–∫",
            "–ü–µ—Ä–µ–Ω–æ—Å —Å–ª–æ–≤",
            "–ß–∞—Å—Ç–∏ —Ä–µ—á–∏ (–∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ)",
            "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ"
        ],
        "3": [
            "–°–æ—Å—Ç–∞–≤ —Å–ª–æ–≤–∞",
            "–ü—Ä–∏—Å—Ç–∞–≤–∫–∏ –∏ —Å—É—Ñ—Ñ–∏–∫—Å—ã",
            "–ë–µ–∑—É–¥–∞—Ä–Ω—ã–µ –≤ –∫–æ—Ä–Ω–µ",
            "–ù–µ–ø—Ä–æ–∏–∑–Ω–æ—Å–∏–º—ã–µ —Å–æ–≥–ª–∞—Å–Ω—ã–µ",
            "–ò–º—è —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ",
            "–ò–º—è –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ",
            "–ì–ª–∞–≥–æ–ª"
        ],
        "4": [
            "–ü–∞–¥–µ–∂–∏ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö",
            "–°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö",
            "–°–ø—Ä—è–∂–µ–Ω–∏–µ –≥–ª–∞–≥–æ–ª–æ–≤",
            "–ú–µ—Å—Ç–æ–∏–º–µ–Ω–∏–µ",
            "–û–¥–Ω–æ—Ä–æ–¥–Ω—ã–µ —á–ª–µ–Ω—ã",
            "–°–ª–æ–∂–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è",
            "–ü—Ä—è–º–∞—è —Ä–µ—á—å"
        ]
    },
    reading: {
        preschool: [
            "–°–∫–∞–∑–∫–∏ –æ –∂–∏–≤–æ—Ç–Ω—ã—Ö",
            "–ü–æ—Ç–µ—à–∫–∏ –∏ –ø—Ä–∏–±–∞—É—Ç–∫–∏",
            "–ó–∞–≥–∞–¥–∫–∏"
        ],
        "1": [
            "–†—É—Å—Å–∫–∏–µ –Ω–∞—Ä–æ–¥–Ω—ã–µ —Å–∫–∞–∑–∫–∏",
            "–°—Ç–∏—Ö–∏ –ê. –ë–∞—Ä—Ç–æ",
            "–°—Ç–∏—Ö–∏ –°. –ú–∞—Ä—à–∞–∫–∞",
            "–°–∫–∞–∑–∫–∏ –ö. –ß—É–∫–æ–≤—Å–∫–æ–≥–æ",
            "–†–∞—Å—Å–∫–∞–∑—ã –æ –¥–µ—Ç—è—Ö"
        ],
        "2": [
            "–°–∫–∞–∑–∫–∏ –ê.–°. –ü—É—à–∫–∏–Ω–∞",
            "–†–∞—Å—Å–∫–∞–∑—ã –ù. –ù–æ—Å–æ–≤–∞",
            "–†–∞—Å—Å–∫–∞–∑—ã –í. –î—Ä–∞–≥—É–Ω—Å–∫–æ–≥–æ",
            "–ü–æ—Å–ª–æ–≤–∏—Ü—ã –∏ –ø–æ–≥–æ–≤–æ—Ä–∫–∏",
            "–°—Ç–∏—Ö–∏ –æ –ø—Ä–∏—Ä–æ–¥–µ"
        ],
        "3": [
            "–†—É—Å—Å–∫–∏–µ –±—ã–ª–∏–Ω—ã",
            "–ë–∞—Å–Ω–∏ –ò.–ê. –ö—Ä—ã–ª–æ–≤–∞",
            "–†–∞—Å—Å–∫–∞–∑—ã –õ.–ù. –¢–æ–ª—Å—Ç–æ–≥–æ",
            "–†–∞—Å—Å–∫–∞–∑—ã –ê.–ü. –ß–µ—Ö–æ–≤–∞",
            "–°–∫–∞–∑–∫–∏ –Ω–∞—Ä–æ–¥–æ–≤ –º–∏—Ä–∞"
        ],
        "4": [
            "–°–∫–∞–∑—ã –ü. –ë–∞–∂–æ–≤–∞",
            "–ê–∫—Å–∞–∫–æ–≤ '–ê–ª–µ–Ω—å–∫–∏–π —Ü–≤–µ—Ç–æ—á–µ–∫'",
            "–†–∞—Å—Å–∫–∞–∑—ã –æ –≤–æ–π–Ω–µ",
            "–°—Ç–∏—Ö–∏ –æ –†–æ–¥–∏–Ω–µ",
            "–ó–∞—Ä—É–±–µ–∂–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞"
        ]
    },
    world: {
        preschool: [
            "–í—Ä–µ–º–µ–Ω–∞ –≥–æ–¥–∞",
            "–î–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ",
            "–î–∏–∫–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ",
            "–û–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã"
        ],
        "1": [
            "–ñ–∏–≤–∞—è –∏ –Ω–µ–∂–∏–≤–∞—è –ø—Ä–∏—Ä–æ–¥–∞",
            "–†–∞—Å—Ç–µ–Ω–∏—è",
            "–ñ–∏–≤–æ—Ç–Ω—ã–µ",
            "–í—Ä–µ–º–µ–Ω–∞ –≥–æ–¥–∞",
            "–ú–æ—è —Å–µ–º—å—è"
        ],
        "2": [
            "–ü—Ä–∏—Ä–æ–¥–Ω—ã–µ –∑–æ–Ω—ã",
            "–ü–æ–≥–æ–¥–∞",
            "–í–æ–¥–∞ –≤ –ø—Ä–∏—Ä–æ–¥–µ",
            "–ö—Ä–∞—Å–Ω–∞—è –∫–Ω–∏–≥–∞",
            "–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏"
        ],
        "3": [
            "–¢–µ–ª–æ —á–µ–ª–æ–≤–µ–∫–∞",
            "–û—Ä–≥–∞–Ω—ã —á—É–≤—Å—Ç–≤",
            "–≠–∫–æ–ª–æ–≥–∏—è",
            "–ü–æ–ª–µ–∑–Ω—ã–µ –∏—Å–∫–æ–ø–∞–µ–º—ã–µ",
            "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏"
        ],
        "4": [
            "–ü—Ä–∏—Ä–æ–¥–Ω—ã–µ –∑–æ–Ω—ã –†–æ—Å—Å–∏–∏",
            "–ú–∞—Ç–µ—Ä–∏–∫–∏ –∏ –æ–∫–µ–∞–Ω—ã",
            "–ò—Å—Ç–æ—Ä–∏—è –û—Ç–µ—á–µ—Å—Ç–≤–∞",
            "–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ –∏ –ø—Ä–∞–≤–æ",
            "–í–µ–ª–∏–∫–∏–µ –ª—é–¥–∏ –†–æ—Å—Å–∏–∏"
        ]
    },
    logic: {
        preschool: [
            "–ù–∞–π–¥–∏ –ª–∏—à–Ω–µ–µ",
            "–ü—Ä–æ–¥–æ–ª–∂–∏ —Ä—è–¥",
            "–ù–∞–π–¥–∏ –ø–∞—Ä—É"
        ],
        "1": [
            "–ù–∞–π–¥–∏ –ª–∏—à–Ω–µ–µ",
            "–ó–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏",
            "–õ–æ–≥–∏—á–µ—Å–∫–∏–µ —Ü–µ–ø–æ—á–∫–∏",
            "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ"
        ],
        "2": [
            "–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏",
            "–†–µ–±—É—Å—ã",
            "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
            "–ò—Å—Ç–∏–Ω–∞ –∏ –ª–æ–∂—å"
        ],
        "3": [
            "–ó–∞–¥–∞—á–∏ –Ω–∞ —Å–º–µ–∫–∞–ª–∫—É",
            "–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞",
            "–ì—Ä–∞—Ñ—ã",
            "–®–∏—Ñ—Ä—ã –∏ –∫–æ–¥—ã"
        ],
        "4": [
            "–°–ª–æ–∂–Ω—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏",
            "–ó–∞–¥–∞—á–∏ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏",
            "–ü—Ä–∏–Ω—Ü–∏–ø –î–∏—Ä–∏—Ö–ª–µ",
            "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–±—É—Å—ã"
        ]
    },
    english: {
        preschool: [
            "–¶–≤–µ—Ç–∞ (Colours)",
            "–ß–∏—Å–ª–∞ 1-10 (Numbers)",
            "–ñ–∏–≤–æ—Ç–Ω—ã–µ (Animals)"
        ],
        "1": [
            "–ê–ª—Ñ–∞–≤–∏—Ç",
            "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è",
            "–¶–≤–µ—Ç–∞",
            "–ß–∏—Å–ª–∞ 1-20",
            "–°–µ–º—å—è (Family)"
        ],
        "2": [
            "–ñ–∏–≤–æ—Ç–Ω—ã–µ",
            "–ï–¥–∞ (Food)",
            "–ò–≥—Ä—É—à–∫–∏ (Toys)",
            "–ß–∞—Å—Ç–∏ —Ç–µ–ª–∞",
            "–ì–ª–∞–≥–æ–ª to be"
        ],
        "3": [
            "–î–Ω–∏ –Ω–µ–¥–µ–ª–∏",
            "–ú–µ—Å—è—Ü—ã",
            "–í—Ä–µ–º—è (Time)",
            "Present Simple",
            "–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ"
        ],
        "4": [
            "Present Continuous",
            "Past Simple",
            "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã",
            "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö",
            "–ü—Ä–µ–¥–ª–æ–≥–∏ –º–µ—Å—Ç–∞"
        ]
    }
};

const TASK_TYPES = {
    math: [
        { id: "examples", label: "‚ûï –ü—Ä–∏–º–µ—Ä—ã", default: true },
        { id: "problems", label: "üìù –ó–∞–¥–∞—á–∏", default: true },
        { id: "compare", label: "‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ" },
        { id: "sequence", label: "üî¢ –ü—Ä–æ–¥–æ–ª–∂–∏ —Ä—è–¥" },
        { id: "missing", label: "‚ùì –ü—Ä–æ–ø—É—â–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ" },
        { id: "equations", label: "üî£ –£—Ä–∞–≤–Ω–µ–Ω–∏—è" }
    ],
    russian: [
        { id: "insert_letter", label: "‚úèÔ∏è –í—Å—Ç–∞–≤—å –±—É–∫–≤—É", default: true },
        { id: "stress", label: "üì¢ –ü–æ—Å—Ç–∞–≤—å —É–¥–∞—Ä–µ–Ω–∏–µ" },
        { id: "syllables", label: "‚ûó –†–∞–∑–¥–µ–ª–∏ –Ω–∞ —Å–ª–æ–≥–∏" },
        { id: "find_error", label: "üîç –ù–∞–π–¥–∏ –æ—à–∏–±–∫—É" },
        { id: "word_groups", label: "üì¶ –†–∞–∑–¥–µ–ª–∏ –Ω–∞ –≥—Ä—É–ø–ø—ã" },
        { id: "sentences", label: "üìÑ –°–æ—Å—Ç–∞–≤—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ" }
    ],
    reading: [
        { id: "match_hero", label: "üé≠ –°–æ–µ–¥–∏–Ω–∏ –≥–µ—Ä–æ—è –∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ", default: true },
        { id: "order_events", label: "üìã –†–∞—Å—Å—Ç–∞–≤—å —Å–æ–±—ã—Ç–∏—è –ø–æ –ø–æ—Ä—è–¥–∫—É", default: true },
        { id: "who_said", label: "üí¨ –ö—Ç–æ —ç—Ç–æ —Å–∫–∞–∑–∞–ª?" },
        { id: "find_quote", label: "üìñ –£–∑–Ω–∞–π –ø–æ –æ—Ç—Ä—ã–≤–∫—É" },
        { id: "proverbs", label: "üó£Ô∏è –ü–æ–¥–±–µ—Ä–∏ –ø–æ—Å–ª–æ–≤–∏—Ü—É" },
        { id: "character", label: "üë§ –û–ø–∏—à–∏ –≥–µ—Ä–æ—è" }
    ],
    world: [
        { id: "match", label: "üîó –°–æ–µ–¥–∏–Ω–∏", default: true },
        { id: "true_false", label: "‚úÖ –í–µ—Ä–Ω–æ/–Ω–µ–≤–µ—Ä–Ω–æ", default: true },
        { id: "groups", label: "üì¶ –†–∞–∑–¥–µ–ª–∏ –Ω–∞ –≥—Ä—É–ø–ø—ã" },
        { id: "fill_gaps", label: "üìù –ó–∞–ø–æ–ª–Ω–∏ –ø—Ä–æ–ø—É—Å–∫–∏" },
        { id: "order", label: "üî¢ –†–∞—Å—Å—Ç–∞–≤—å –ø–æ –ø–æ—Ä—è–¥–∫—É" }
    ],
    logic: [
        { id: "odd_one", label: "‚ùå –ù–∞–π–¥–∏ –ª–∏—à–Ω–µ–µ", default: true },
        { id: "pattern", label: "üîÑ –ü—Ä–æ–¥–æ–ª–∂–∏ —Ä—è–¥", default: true },
        { id: "pairs", label: "üëØ –ù–∞–π–¥–∏ –ø–∞—Ä—É" },
        { id: "riddles", label: "‚ùì –ó–∞–≥–∞–¥–∫–∏" },
        { id: "maze", label: "üåÄ –õ–∞–±–∏—Ä–∏–Ω—Ç" }
    ],
    english: [
        { id: "translate", label: "üîÑ –ü–µ—Ä–µ–≤–µ–¥–∏", default: true },
        { id: "match_word", label: "üîó –°–æ–µ–¥–∏–Ω–∏ —Å–ª–æ–≤–æ –∏ –∫–∞—Ä—Ç–∏–Ω–∫—É" },
        { id: "fill_letter", label: "‚úèÔ∏è –í—Å—Ç–∞–≤—å –±—É–∫–≤—É", default: true },
        { id: "order_words", label: "üìù –°–æ—Å—Ç–∞–≤—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ" },
        { id: "choose", label: "‚òëÔ∏è –í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç" }
    ]
};

const SUBJECT_NAMES = {
    math: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
    russian: "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", 
    reading: "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ",
    world: "–û–∫—Ä—É–∂–∞—é—â–∏–π –º–∏—Ä",
    logic: "–õ–æ–≥–∏–∫–∞",
    english: "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫"
};

const GRADE_NAMES = {
    preschool: "–¥–æ—à–∫–æ–ª—å–Ω–∏–∫–æ–≤",
    "1": "1 –∫–ª–∞—Å—Å–∞",
    "2": "2 –∫–ª–∞—Å—Å–∞",
    "3": "3 –∫–ª–∞—Å—Å–∞",
    "4": "4 –∫–ª–∞—Å—Å–∞"
};

const DIFFICULTY_PROMPTS = {
    easy: "–ó–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ü–†–û–°–¢–´–ú–ò, –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö. –ß–∏—Å–ª–∞ –º–∞–ª–µ–Ω—å–∫–∏–µ, —Å–ª–æ–≤–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ.",
    medium: "–ó–∞–¥–∞–Ω–∏—è –°–†–ï–î–ù–ï–ô —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞.",
    hard: "–ó–∞–¥–∞–Ω–∏—è –°–õ–û–ñ–ù–´–ï, –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —É—á–µ–Ω–∏–∫–æ–≤. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ö–∏—Ç—Ä—ã–µ —Å–ª—É—á–∞–∏.",
    mixed: "–°–¥–µ–ª–∞–π –∑–∞–¥–∞–Ω–∏—è –†–ê–ó–ù–û–ô —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –∫ —Å–ª–æ–∂–Ω—ã–º (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è)."
};


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ö–û–ù–°–¢–†–£–ö–¢–û–†–ê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function initPromptBuilder() {
    const subjectSelect = document.getElementById("subject-select");
    const gradeSelect = document.getElementById("grade-select");
    const topicSelect = document.getElementById("topic-select");
    const customTopic = document.getElementById("custom-topic");
    const tasksNum = document.getElementById("tasks-num");
    const extraWishes = document.getElementById("extra-wishes");
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—Ä–µ–¥–º–µ—Ç–∞/–∫–ª–∞—Å—Å–∞
    subjectSelect?.addEventListener("change", updateTopics);
    gradeSelect?.addEventListener("change", updateTopics);
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∑–∞–¥–∞–Ω–∏–π –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—Ä–µ–¥–º–µ—Ç–∞
    subjectSelect?.addEventListener("change", updateTaskTypes);
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
    [subjectSelect, gradeSelect, topicSelect, customTopic, tasksNum, extraWishes].forEach(el => {
        el?.addEventListener("change", updatePromptPreview);
        el?.addEventListener("input", updatePromptPreview);
    });
    
    // –ö–Ω–æ–ø–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
    document.querySelectorAll(".diff-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            document.querySelectorAll(".diff-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            updatePromptPreview();
        });
    });
    
    // –°–ª–∞–π–¥–µ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
    tasksNum?.addEventListener("input", () => {
        document.getElementById("tasks-num-value").textContent = tasksNum.value;
        updatePromptPreview();
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateTaskTypes();
    updatePromptPreview();
}


function updateTopics() {
    const subject = document.getElementById("subject-select")?.value;
    const grade = document.getElementById("grade-select")?.value;
    const topicSelect = document.getElementById("topic-select");
    
    if (!topicSelect) return;
    
    topicSelect.innerHTML = '<option value="">‚Äî –í—ã–±–µ—Ä–∏ —Ç–µ–º—É ‚Äî</option>';
    
    if (subject && grade && TOPICS[subject]?.[grade]) {
        TOPICS[subject][grade].forEach(topic => {
            const option = document.createElement("option");
            option.value = topic;
            option.textContent = topic;
            topicSelect.appendChild(option);
        });
    }
    
    updatePromptPreview();
}


function updateTaskTypes() {
    const subject = document.getElementById("subject-select")?.value || "math";
    const container = document.getElementById("task-types");
    
    if (!container) return;
    
    const types = TASK_TYPES[subject] || TASK_TYPES.math;
    
    container.innerHTML = types.map(type => `
        <label class="task-type-checkbox">
            <input type="checkbox" value="${type.id}" ${type.default ? 'checked' : ''}>
            <span>${type.label}</span>
        </label>
    `).join("");
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    container.querySelectorAll("input").forEach(cb => {
        cb.addEventListener("change", updatePromptPreview);
    });
    
    updatePromptPreview();
}


function getSelectedTaskTypes() {
    const checkboxes = document.querySelectorAll("#task-types input:checked");
    return Array.from(checkboxes).map(cb => {
        const label = cb.parentElement.querySelector("span").textContent;
        return label.replace(/^[^\s]+\s/, ""); // –£–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∑–∏
    });
}


function updatePromptPreview() {
    const preview = document.getElementById("prompt-preview-text");
    if (!preview) return;
    
    const prompt = buildUserPrompt();
    preview.textContent = prompt || "–í—ã–±–µ—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã—à–µ...";
}


function buildUserPrompt() {
    const subject = document.getElementById("subject-select")?.value;
    const grade = document.getElementById("grade-select")?.value;
    const topic = document.getElementById("topic-select")?.value;
    const customTopic = document.getElementById("custom-topic")?.value?.trim();
    const tasksNum = document.getElementById("tasks-num")?.value || 5;
    const extraWishes = document.getElementById("extra-wishes")?.value?.trim();
    const difficulty = document.querySelector(".diff-btn.active")?.dataset.diff || "mixed";
    
    if (!subject) return "";
    
    const subjectName = SUBJECT_NAMES[subject];
    const gradeName = grade ? GRADE_NAMES[grade] : "";
    const topicText = customTopic || topic || "";
    const taskTypes = getSelectedTaskTypes();
    
    let prompt = `${subjectName}`;
    
    if (gradeName) {
        prompt += ` –¥–ª—è ${gradeName}`;
    }
    
    if (topicText) {
        prompt += `. –¢–µ–º–∞: ${topicText}`;
    }
    
    prompt += `. ${tasksNum} –∑–∞–¥–∞–Ω–∏–π.`;
    
    if (taskTypes.length > 0) {
        prompt += ` –¢–∏–ø—ã: ${taskTypes.join(", ")}.`;
    }
    
    prompt += ` ${DIFFICULTY_PROMPTS[difficulty]}`;
    
    if (extraWishes) {
        prompt += ` –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: ${extraWishes}`;
    }
    
    return prompt;
}


// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è app.js
function getBuiltPrompt() {
    return buildUserPrompt();
}